# Test Plan: VibeTravels 2.0

| **Project:**          | VibeTravels 2.0 (AI Travel Planner) |
| :-------------------- | :---------------------------------- |
| **Document Version:** | 1.0                                 |

---

## 1. üìñ Introduction and Test Objectives

### 1.1. Introduction

This document defines the strategy, scope, resources, and schedule for testing the VibeTravels 2.0 application. VibeTravels is a Full-Stack web application based on .NET 9 (Backend) and Angular 20 (Frontend) architecture. Its key functionality is generating travel plans (itineraries) based on user notes using AI (GPT-4o-mini).

Testing aims to ensure that the MVP (Minimum Viable Product) version meets all functional and non-functional requirements defined in the project documentation (PRD) and is stable, secure, and efficient.

### 1.2. Main Test Objectives

- Verification that all User Stories defined in the PRD (e.g., US-01 to US-10) have been correctly implemented.
- Ensuring the stability and correctness of the **asynchronous plan generation** flow by AI (including handling states: `queued`, `running`, `succeeded`, `failed`).
- Confirmation that **authentication (JWT)** and **authorization (data ownership)** mechanisms work correctly, and user data is fully isolated.
- Verification of the correct operation of basic **CRUD** (Create, Read, Update, Delete) functions for Notes and User Profiles.
- Ensuring user interface consistency, its responsiveness, and proper error handling.
- Checking the correctness of integration with external services (PostgreSQL, OpenAI API).

---

## 2. üéØ Test Scope

### 2.1. Functionalities In Scope

- **Authentication Module:** Registration, login, session management (JWT), route protection.
- **Notes Module (CRUD):** Creating, editing, deleting (soft delete), and listing notes. Field validation (length, required fields).
- **User Profile Module:** Creating and updating travel preferences (style, accommodation, climate).
- **Plan Generation Module (AI):**
  - Initiating plan generation from a note.
  - Correctness of parameter passing (days, travelers, date).
  - **Mock Mode Testing** (`OpenAi.Enabled: false`): Verification of the entire pipeline (queuing, background service, status changes, `Plan` entity saving).
  - **Live Mode Testing** (`OpenAi.Enabled: true`): Verification of integration with the OpenAI API and the correctness of the response structure (daily plan vs. activity list).
- **Plan Management Module:** Listing plans, viewing details, handling the lifecycle (Accept, Reject, Retry, Edit content).
- **Security:** User data isolation (tenancy) - verification that user A does not have access to user B's data.
- **User Interface (UI/UX):** Basic responsiveness, theme switching (light/dark), notification handling (errors, successes).
- **API:** Testing all endpoints defined in `VibeTravels.Api` (as per the `.http` files).

### 2.2. Functionalities Out of Scope

- Formal performance, load, and stress tests (beyond basic observation of AI response time).
- Advanced penetration testing (beyond verifying basic authorization rules).
- Functionalities explicitly excluded from the MVP (e.g., sharing plans, multimedia handling).
- Testing the CI/CD pipeline itself (GitHub Actions).
- Testing of external libraries (Angular Material, OpenAI API) - we focus on _integration_ with them.

---

## 3. üß™ Test Types

The plan includes the following levels and types of tests to ensure full application coverage:

1.  **Unit Tests:**

    - **Backend (.NET):** Focus on business logic in the `VibeTravels.Core` layer (e.g., Value Object validators like `NoteBody`, `Password`) and in `VibeTravels.Application` (Command/Query Handlers with mocked repositories).
    - **Frontend (Angular):** Testing individual components (e.g., `note-form-dialog.ts`) with mocked services (e.g., `NotesApiService`) and testing form validators.

2.  **Integration Tests:**

    - **Backend (.NET):** The most important type of test for the backend. Testing CQRS flows (Command/Query Handlers) with a **real database in a container** (e.g., Testcontainers with PostgreSQL). The goal is to verify business logic, EF Core mappings, and the correctness of repositories and the database schema (e.g., `ON DELETE` rules).
    - Special emphasis on testing the `PlanGenerationBackgroundService` with a mocked `IAiPlanGeneratorService` to check the correctness of the asynchronous status change logic.

3.  **API Tests (API / E2E Backend):**

    - Black-box testing for `VibeTravels.Api`. Using the provided `.http` files (or Postman) to verify each endpoint for:
      - Correct responses (200, 201, 204).
      - Error handling (400, 401, 403, 404, 500).
      - Request DTO validation.
      - Correct operation of the JWT mechanism.

4.  **End-to-End (E2E UI) Tests:**

    - Automation of full user flows in the browser (e.g., using Cypress or Playwright).
    - Scenarios will cover the entire lifecycle: Register -> Login -> Complete profile -> Create note -> Generate plan (with status polling) -> Accept plan -> Logout.

5.  **Configuration Tests:**

    - Crucial for this project. Executing a set of E2E and API tests for both operating modes:
      - Mode 1: `OpenAi.Enabled: false` (mock service must work).
      - Mode 2: `OpenAi.Enabled: true` (OpenAI integration must work).

6.  **Security Tests (Basic):**

    - Verification of data isolation (tenancy) by attempting to access another user's resources (e.g., `GET /api/notes/{another_user_note_id}`). Expected result: 403 Forbidden or 404 Not Found.
    - Verification of endpoint protection (attempting access without a JWT token).

7.  **Smoke Tests:**
    - A narrow set of critical scenarios (login, display note list, initiate plan generation), run after each deployment to the test environment to confirm build stability.

---

## 4. üìã Test Scenarios (Key Functionalities)

The following table presents high-priority test scenarios (P0 and P1) based on PRD and code analysis.

| Module                   | Priority | Scenario ID | Scenario Description                                                                                                       | Expected Result                                                                                                                                                                                                                                                                                                                                                                                   |
| :----------------------- | :------- | :---------- | :------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Authentication**       | **P0**   | AUTH-01     | Register a new user with valid data (unique email, strong password).                                                       | The user is created in the database, and a session (UI) is automatically established.                                                                                                                                                                                                                                                                                                             |
|                          | **P0**   | AUTH-02     | Log in an existing user with valid credentials.                                                                            | The user is logged in, receives a JWT token.                                                                                                                                                                                                                                                                                                                                                      |
|                          | P1       | AUTH-03     | Attempt to log in with an incorrect password.                                                                              | The user is not logged in, sees an error message about incorrect credentials.                                                                                                                                                                                                                                                                                                                     |
|                          | P1       | AUTH-04     | Attempt to access a protected resource (e.g., `/api/profiles/me`) without a JWT token.                                     | The API returns a 401 Unauthorized status.                                                                                                                                                                                                                                                                                                                                                        |
| **Notes (CRUD)**         | **P0**   | NOTE-01     | A user creates a new note with valid data (title, location, content > 100 chars).                                          | The note is saved in the database and is visible on the user's note list.                                                                                                                                                                                                                                                                                                                         |
|                          | P1       | NOTE-02     | A user edits an existing note.                                                                                             | Changes are saved to the database, `UpdatedAt` timestamp is updated.                                                                                                                                                                                                                                                                                                                              |
|                          | P1       | NOTE-03     | A user deletes a note (soft delete).                                                                                       | The note receives a `DeletedAt` timestamp and disappears from the default list view.                                                                                                                                                                                                                                                                                                              |
|                          | P1       | NOTE-04     | Attempt to create a note with invalid validation (e.g., content < 100 chars).                                              | The API returns a 400 validation error, UI displays a message.                                                                                                                                                                                                                                                                                                                                    |
| **Plan Generation (AI)** | **P0**   | PLAN-01     | **(Async Test - Mock)** User generates a plan.                                                                             | 1. API returns 201/202. <br> 2. A `trip_request` and `plan_generation` (status `queued`) are created in the DB. <br> 3. UI shows a loading state. <br> 4. `PlanGenerationBackgroundService` changes status to `running`. <br> 5. The (mock) service finishes, status changes to `succeeded`. <br> 6. A `Plan` entity is created. <br> 7. UI (via polling) refreshes and shows the completed plan. |
|                          | **P0**   | PLAN-02     | **(Live AI Test - Structure)** User generates a plan, specifying the number of days (e.g., 7).                             | The generated plan (in `Plan.Content`) has a **daily** structure (e.g., "Day 1", "Day 2"...).                                                                                                                                                                                                                                                                                                     |
|                          | P1       | PLAN-03     | **(Live AI Test - Structure)** User generates a plan, _not_ specifying the number of days.                                 | The generated plan has an **activity list** structure (without a day-by-day breakdown).                                                                                                                                                                                                                                                                                                           |
|                          | P1       | PLAN-04     | **(Async Test - Error)** Plan generation fails (e.g., OpenAI API unavailable).                                             | The `plan_generation` status changes to `failed`. UI shows an error message and a "Retry" option.                                                                                                                                                                                                                                                                                                 |
|                          | P1       | PLAN-05     | User retries (Retry) a failed generation.                                                                                  | A _new_ `plan_generation` process is created (or the old one is reset to `queued`) and the process starts over.                                                                                                                                                                                                                                                                                   |
| **Security**             | **P0**   | SEC-01      | **(Data Isolation Test)** User A (logged in) attempts to fetch User B's note via API (e.g., `GET /api/notes/{note_id_B}`). | The API returns a 403 Forbidden or 404 Not Found status. Data is not disclosed.                                                                                                                                                                                                                                                                                                                   |

---

## 5. üñ•Ô∏è Test Environment

| Environment        | Description                                    | URL (Backend)                      | URL (Frontend)                 | Database                | AI Mode                           |
| :----------------- | :--------------------------------------------- | :--------------------------------- | :----------------------------- | :---------------------- | :-------------------------------- |
| **Local (Dev)**    | Development environment as per `README.md`     | `http://localhost:5131`            | `http://localhost:4200`        | PostgreSQL (Docker)     | `OpenAi.Enabled: false` (default) |
| **Test (Staging)** | (Suggested) Isolated instance on DigitalOcean. | `https://api-test.vibetravels.com` | `https://test.vibetravels.com` | Dedicated PostgreSQL DB | `OpenAi.Enabled: true`            |

**Key Test Data:**

- At least two different test users (User A, User B) to verify data isolation.
- A set of API keys (one valid, one invalid) for testing OpenAI integration.
- Test notes of varying lengths and content.

---

## 6. üõ†Ô∏è Test Tools

- **Test & Bug Management:** GitHub Issues (or Jira/Trello, if available).
- **Unit Tests (Backend):** xUnit or NUnit (standard for .NET).
- **Integration Tests (Backend):** Testcontainers (for running PostgreSQL DB in tests), Moq (for mocking `IAiPlanGeneratorService`).
- **Unit Tests (Frontend):** Karma / Jest (provided with Angular).
- **API Tests:** VS Code REST Client (based on existing `.http` files) and Postman (for more complex scenarios and assertions).
- **E2E (UI) Tests:** Playwright (recommended for its modern API and async handling).
- **Code Repository:** Git / GitHub.

---

## 7. üóìÔ∏è Test Schedule (Suggested)

Testing should be a continuous process, integrated with the development lifecycle.

- **Phase 1: Unit and Integration Tests (Continuous)**
  - Performed by developers and QA in parallel with the implementation of each new feature (each Command/Query Handler, each UI component).
- **Phase 2: API and E2E Tests (After MVP sprint closure)**
  - After the full MVP is deployed to the test environment.
  - Execution of the full set of P0 and P1 scenarios.
  - Duration: approx. 3-5 business days.
- **Phase 3: Regression and Acceptance Tests (Before release)**
  - After fixing critical bugs from Phase 2.
  - Execution of the full test suite (P0, P1, P2) to ensure fixes did not break existing functionality.
  - Acceptance tests (UAT) performed by the Product Owner.

---

## 8. ‚úÖ Test Acceptance Criteria

### 8.1. Entry Criteria (Start of Phase 2 testing)

- All MVP features defined in the PRD have been implemented.
- The application has been successfully built and deployed to the test (Staging) environment.
- Key unit and integration tests are passing.
- API documentation (e.g., Swagger/Scalar) is available.

### 8.2. Exit Criteria (End of testing / Ready for release)

- **100%** of Smoke Tests are passing.
- **100%** of **P0** priority test scenarios are passing.
- **95%** of **P1** priority test scenarios are passing.
- No open bugs with **Blocker** or **Critical** status exist.
- All known lower-priority bugs are documented and accepted by the Product Owner (can be moved to the backlog).

---

## 9. üßë‚Äçü§ù‚Äçüßë Roles and Responsibilities

- **Developers (.NET / Angular):**
  - Implementing unit tests for their code.
  - Conducting mutual Code Reviews (including test reviews).
  - Fixing bugs reported by QA.
  - Maintaining the local environment as per `README.md`.
- **QA Engineer (Plan Author):**
  - Designing, executing, and maintaining integration, API, and E2E tests.
  - Performing regression and smoke tests.
  - Accurately reporting bugs and verifying fixes (re-testing).
  - Managing the test environment.
- **Product Owner (PO):**
  - Defining feature priorities (based on PRD).
  - Performing User Acceptance Testing (UAT).
  - Final approval for the product release.

---

## 10. üêû Bug Reporting Procedures

All bugs must be reported in the bug tracking system (e.g., GitHub Issues) and should include the following information:

- **Title:** A concise and clear description of the problem (e.g., "[API] [403] User A can edit User B's note").
- **Environment:** (Local / Test (Staging)).
- **Steps to Reproduce (STR):** A numbered list of steps required to trigger the bug.
- **Expected Result:** What should have happened.
- **Actual Result:** What actually happened.
- **Priority:**
  - **Blocker:** Blocks further testing or prevents a key feature from working (e.g., login fails).
  - **Critical:** A serious bug in a key functionality (e.g., plan generation always fails).
  - **Major:** A bug in functionality, but a workaround exists.
  - **Minor:** A cosmetic (UI) bug, typo, etc.
- **Attachments:** Screenshots, video recordings, log snippets, API request/response content.
